<!DOCTYPE html>
<html>
<head>
    <title>Mappa Comuni Basilicata (Selezione Colori Basi)</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>
    <script src="https://unpkg.com/togeojson@0.16.1/togeojson.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <style>
        #map { height: 500px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid black; padding: 8px; text-align: left; }
    </style>
</head>
<body>
    <h1>Mappa Comuni Basilicata (Selezione Colori Basi)</h1>
    <table>
        <thead>
            <tr>
                <th>Base</th>
                <th>Colore</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>base_a1</td>
                <td><input type="color" id="base_a1" value="#ff0000"></td>
            </tr>
            <tr>
                <td>base_a2</td>
                <td><input type="color" id="base_a2" value="#0000ff"></td>
            </tr>
            <tr>
                <td>base_b</td>
                <td><input type="color" id="base_b" value="#008000"></td>
            </tr>
            <tr>
                <td>base_c</td>
                <td><input type="color" id="base_c" value="#ffff00"></td>
            </tr>
            <tr>
                <td>base_d</td>
                <td><input type="color" id="base_d" value="#ffa500"></td>
            </tr>
            <tr>
                <td>base_e1</td>
                <td><input type="color" id="base_e1" value="#800080"></td>
            </tr>
            <tr>
                <td>base_e2</td>
                <td><input type="color" id="base_e2" value="#ffc0cb"></td>
            </tr>
        </tbody>
    </table>
    <button onclick="generaMappa()">Genera Mappa</button>
    <button onclick="generaPDF()">Genera PDF</button>
    <div id="map"></div>

    <script>
        let map = L.map('map').setView([40.6394, 16.1477], 8);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        let comuniLayer;
        let coloriComuni = {};

        let basiComuni = {
            base_a1: ["76006", "76011", "76032", "76033", "76099", "76043", "76047", "76048", "76051", "76057", "76058", "76064", "76065", "76066", "76067", "76072", "76076", "76095"],
            base_a2: ["76008", "76010", "76012", "76013", "76021", "76053", "76059", "76071", "76079", "76082", "76083", "76084", "76089", "76096"],
            base_b: ["76001", "77001", "76002", "76003", "76007", "76009", "77003", "77004", "76015", "76017", "76018", "76024", "77008", "76036", "77010", "77011", "77012", "77013", "76041", "77014", "77015", "77019", "76056", "76060", "76061", "76062", "77022", "76063", "77024", "76073", "76077", "77026", "76089", "76090", "77028", "76093", "76094"],
            base_c: ["77002", "76016", "76019", "76026", "76027", "76028", "77005", "77006", "76029", "76030", "76031", "76034", "76035", "76037", "76038", "76045", "76046", "76049", "76050", "76052", "76055", "76100", "76069", "76074", "76075", "77025", "76080", "76081", "76085", "76086", "77027", "76087", "76088", "76091", "77029", "77030", "76098"],
            base_d: ["76022", "76023", "76025", "76039", "76040", "76042", "76044", "76054", "76068", "76070", "76092", "76097"],
            base_e1: ["77018", "77021", "77023", "77031", "77029", "77016"],
            base_e2: ["77003", "77017", "77020", "77022", "77008", "77007"]
        };

        let comuniData = {
            "76035": "Gallicchio",
            "76005": "Armento",
            "76078": "San Severino Lucano",
            "76079": "Sant'Angelo Le Fratte",
            "76088": "Terranova di Pollino",
            "76086": "Spinoso",
            "76042": "Lauria",
            "76087": "Teana",
            "76093": "Trivigno",
            "76047": "Maschito",
            "76056": "Oppido Lucano",
            "76059": "Picerno",
            "76080": "Sant'Arcangelo",
            "76073": "San Chirico Nuovo",
            "76094": "Vaglio Basilicata",
            "76092": "Trecchina",
            "77030": "Valsinni",
            "77001": "Accettura",
            "77024": "Salandra",
            "76037": "Grumento Nova",
            "77005": "Cirigliano",
            "77006": "Colobraro",
            "76053": "Muro Lucano",
            "76067": "Ripacandida",
            "76083": "Satriano di Lucania",
            "77020": "Pisticci",
            "76070": "Rotonda",
            "76038": "Guardia Perticara",
            "76041": "Laurenzana",
            "77011": "Grassano",
            "77002": "Aliano",
            "77007": "Craco",
            "77004": "Calciano",
            "76052": "Montemurro",
            "76055": "Noepoli",
            "76069": "Roccanova",
            "77010": "Gorgoglione",
            "77014": "Matera",
            "77017": "Montescaglioso",
            "76085": "Senise",
            "76082": "Sasso di Castalda",
            "76057": "Palazzo San Gervasio",
            "76063": "Potenza",
            "76064": "Rapolla",
            "76074": "San Chirico Raparo",
            "76075": "San Costantino Albanese",
            "76090": "Tolve",
            "76091": "Tramutola",
            "76044": "Maratea",
            "76081": "Sarconi",
            "76048": "Melfi",
            "76049": "Missanello",
            "76050": "Moliterno",
            "76060": "Pietragalla",
            "76077": "San Martino d'Agri",
            "76036": "Genzano di Lucania",
            "76065": "Rapone",
            "76066": "Rionero in Vulture",
            "76054": "Nemoli",
            "76096": "Vietri di Potenza",
            "76089": "Tito",
            "76071": "Ruoti",
            "76045": "Marsico Nuovo",
            "76043": "Lavello",
            "76061": "Pietrapertosa",
            "76095": "Venosa",
            "76058": "Pescopagano",
            "76046": "Marsicovetere",
            "76072": "Ruvo del Monte",
            "76062": "Pignola",
            "76076": "San Fele",
            "76009": "Banzi",
            "76014": "Brindisi Montagna",
            "76015": "Calvello",
            "76040": "Latronico",
            "77025": "San Giorgio Lucano",
            "77018": "Nova Siri",
            "77021": "Policoro",
            "77026": "San Mauro Forte",
            "77008": "Ferrandina",
            "77028": "Tricarico",
            "76099": "Ginestra",
            "77015": "Miglionico",
            "77029": "Tursi",
            "76100": "Paterno",
            "77016": "Montalbano Jonico",
            "77022": "Pomarico",
            "76051": "Montemilone",
            "77012": "Grottole",
            "77019": "Oliveto Lucano",
            "76068": "Rivello",
            "76084": "Savoia di Lucania",
            "77009": "Garaguso",
            "76039": "Lagonegro",
            "77023": "Rotondella",
            "77013": "Irsina",
            "77003": "Bernalda",
            "77027": "Stigliano",
            "77031": "Scanzano Jonico",
            "76097": "Viggianello",
            "76098": "Viggiano",
            "76006": "Atella",
            "76026": "Castronuovo di Sant'Andrea",
            "76029": "Corleto Perticara",
            "76002": "Acerenza",
            "76023": "Castelluccio Superiore",
            "76032": "Filiano",
            "76018": "Cancellara",
            "76024": "Castelmezzano",
            "76010": "Baragiano",
            "76011": "Barile",
            "76030": "Episcopia",
            "76016": "Calvera",
            "76017": "Campomaggiore",
            "76019": "Carbone",
            "76034": "Francavilla in Sinni",
            "76025": "Castelsaraceno",
            "76028": "Chiaromonte",
            "76027": "Cersosimo",
            "76001": "Abriola",
            "76003": "Albano di Lucania",
            "76012": "Bella",
            "76020": "San Paolo Albanese",
            "76033": "Forenza",
            "76013": "Brienza",
            "76031": "Fardella",
            "76021": "Castelgrande",
            "76022": "Castelluccio Inferiore",
            "76007": "Avigliano",
            "76008": "Balvano",
            "76004": "Anzi"
        };
        let coloriBase = {};

        function generaMappa() {
            for (let base in basiComuni) {
                let colore = document.getElementById(base).value;
                coloriBase[base] = colore;
                basiComuni[base].forEach(comuneId => {
                    coloriComuni[comuniData[comuneId]] = colore;
                });
            }

            fetch('basilicata.kml')
                .then(response => response.text())
                .then(kmlString => {
                    let geojson = toGeoJSON.kml(new DOMParser().parseFromString(kmlString, 'text/xml'));
                    comuniLayer = L.geoJSON(geojson, {
                        style: feature => ({
                            fillColor: coloriComuni[comuniData[feature.properties.name]] || '#ffffff',
                            weight: 1,
                            opacity: 1,
                            color: 'black',
                            fillOpacity: 0.7
                        })
                    }).addTo(map);
                });
        }

        function generaPDF() {
            let doc = new jspdf.jsPDF();
            doc.text("Colori delle Basi:", 10, 10);

            let y = 20;
            for (let base in coloriBase) {
                doc.text(`${base}: ${coloriBase[base]}`, 10, y);
                y += 10;
            }

            doc.save("colori_basi.pdf");
        }
    </script>
</body>
</html>

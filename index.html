<!DOCTYPE html>
<html>
<head>
    <title>Mappa Comuni Basilicata</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
        #map { height: 500px; }
    </style>
</head>
<body>
    <h1>Mappa Comuni Basilicata</h1>
    <div id="map"></div>
    <div id="selezioniColori"></div>
    <button onclick="applicaColori()">Applica Colori</button>

    <script>
        let map = L.map('map').setView([40.6394, 16.1477], 8); // Centro sulla Basilicata
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        let comuniLayer;
        let coloriComuni = {};

        fetch('basilicata.kml')
            .then(response => response.text())
            .then(kmlString => {
                let geojson = toGeoJSON.kml(new DOMParser().parseFromString(kmlString, 'text/xml'));
                comuniLayer = L.geoJSON(geojson, {
                    style: feature => ({
                        fillColor: coloriComuni[feature.properties.name] || '#ffffff',
                        weight: 1,
                        opacity: 1,
                        color: 'black',
                        fillOpacity: 0.7
                    })
                }).addTo(map);

                // Genera selezioni colore
                geojson.features.forEach(feature => {
                    aggiungiSelezioneColore(feature.properties.name);
                });
            });

        function aggiungiSelezioneColore(comuneNome) {
            let selezioneColore = document.createElement('div');
            selezioneColore.innerHTML = `<label for="${comuneNome}">Colore per ${comuneNome}:</label><input type="color" id="${comuneNome}" value="#ff0000"><button onclick="salvaColore('${comuneNome}')">Salva</button>`;
            document.getElementById('selezioniColori').appendChild(selezioneColore);
        }

        function salvaColore(comuneNome) {
            coloriComuni[comuneNome] = document.getElementById(comuneNome).value;
        }

        function applicaColori() {
            comuniLayer.setStyle(feature => ({
                fillColor: coloriComuni[feature.properties.name] || '#ffffff',
                weight: 1,
                opacity: 1,
                color: 'black',
                fillOpacity: 0.7
            }));
        }
    </script>
</body>
</html>
